package net.datenwerke.security.ext.server.crypto;

public class KeygenHTML {

   public static String getCreateKeyHTMLCode(String postaction, String tokenvalue) {
      String tmp = createKeyHtmlCode.replaceAll("\\$\\{POSTACTION\\}", postaction); //$NON-NLS-1$
      return tmp.replaceAll("\\$\\{TOKENVALUE\\}", tokenvalue); //$NON-NLS-1$
   }

   public static String getInstallCertificateHtmlCoder(String base64Cert) {
      return installCertificateHtmlCode.replaceAll("\\$\\{BASE64CERT\\}", base64Cert); //$NON-NLS-1$
   }

   private final static String installCertificateHtmlCode = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"     \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n" //$NON-NLS-1$
         + "<html>\r\n" + "  <head>\r\n" + "    \r\n" + "  </head>\r\n" + "  <body>\r\n" + "\r\n" + "<!--\r\n" + "	Courtesy of the ejbca project. Licensed\r\n" + "	under the term of the lgpl\r\n" + "	\r\n" + "	see http://ejbca.org\r\n" + "\r\n" + "-->  \r\n" + " \r\n" + "<object classid=\"clsid:884e2049-217d-11da-b2a4-000e7bbb2b09\" id=\"g_objClassFactory\"></object>\r\n" + "<!-- Updated w CertEnroll for Vista\r\n" + "Class ID: {884e2049-217d-11da-b2a4-000e7bbb2b09}\r\n" + "-->\r\n" + "<!-- New updated enrollment activeX-control 2002-09-02 (Q323172)\r\n" + "New Xenroll.dll information:\r\n" + "Class ID: {127698e4-e730-4e5c-a2b1-21490a70c8a1}\r\n" + "sXEnrollVersion=\"5,131,3659,0\"\r\n" + "\r\n" + "New Scrdenrl.dll information:\r\n" + "Class ID: {c2bbea20-1f2b-492f-8a06-b1c5ffeace3b}\r\n" + "sScrdEnrlVersion=\"5,131,3642,0\"\r\n" + "-->\r\n" + "<!-- Old Xenroll.dll information:\r\n" + "Class ID: {43F8F289-7A20-11D0-8F06-00C04FC295E1}\r\n" + "\r\n" + "Old Scrdenrl.dll information:\r\n" + "Class ID: {80CB7887-20DE-11D2-8D5C-00C04FC29D45}\r\n" + "-->\r\n" + "\r\n" + "	<script language=\"VBScript\" type=\"text/vbscript\">\r\n" + "    cert = \"${BASE64CERT}\"\r\n" + "	\r\n" + "		' This function can be moved to functions.vbs when the header is parsed as jsp\r\n" + "		Sub installcertvista\r\n" + "			Dim objEnroll\r\n" + "			Set objEnroll = g_objClassFactory.CreateObject(\"X509Enrollment.CX509Enrollment\")\r\n" + "			Call objEnroll.Initialize(1)	'EnrollmentContext UserContext\r\n" + "			err.clear\r\n" + "			On Error Resume Next\r\n" + "	        Call objEnroll.InstallResponse(0, cert, 6, \"\")	'AllowNone, , XCN_CRYPT_STRING_BASE64_ANY, pw\r\n"
         + "	        If err.number = -2146762487	Then	' 0x800b0109 Not trusted root\r\n" + "	        	r = Msgbox(\"Could not complete the request since, the CAs' certificates were not properly installed.\", , \"Certificate Management\")\r\n"
         + "			ElseIf err.number <> 0 Then\r\n" + "				r = Msgbox(\"The certificate could not be installed\"  & err.number , , \"Certificate Management\")\r\n"
         + "			Else\r\n" + "				r = Msgbox(\"A new certificate has been installed\", , \"Certificate Management\")\r\n" + "			End If\r\n" + "		End Sub\r\n" + "	\r\n" + "		Sub installcert\r\n" + "			Err.Clear\r\n" + "			On Error Resume Next\r\n" + "			g_objClassFactory.acceptPKCS7(cert)\r\n" + "			If Err.Number <> 0 Then\r\n" + "				r = Msgbox(\"The certificate could not be installed in this web browser\", , \"Certificate Management\")\r\n"
         + "			Else\r\n" + "				r = Msgbox (\"A new certificate has been installed\", , \"Certificate Management\")\r\n" + "			End if\r\n" + "		End Sub\r\n" + "	\r\n" + "		If InStr(navigator.userAgent, \"Windows NT 6\") <> 0 Then\r\n" + "			installcertvista\r\n" + "		Else\r\n" + "			installcert\r\n" + "		End If\r\n" + "	</script>\r\n" + "\r\n" + "	<h1 class=\"title\">Internet Explorer Certificate enrollment.</h1>\r\n" + "    <p>If the installation was completed without any errors, your certificate has\r\n" + "    been installed in your web browser and you may now start using your certificate.<br />\r\n" + "	You can look at your certificate with &quot;<tt>Tools-&gt;Internet\r\n" + "	Options-&gt;Content-&gt;Certificates</tt>&quot;.</p>\r\n" + "	\r\n" + "<!-- Footer -->\r\n" + "     \r\n" + "  </body>\r\n" + "</html>\r\n" + "<!-- Footer -->\r\n" + "";

   private final static String createKeyHtmlCode = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n" //$NON-NLS-1$
         + "\r\n" + "<html>\r\n" + "  <head>\r\n" + "  </head>\r\n" + "  <body>\r\n" + "    \r\n" + "\r\n" + "	<!--\r\n" + "	 	Courtesy of the ejbca project. \r\n" + "	 	http://www.ejbca.org/\r\n" + "	 \r\n" + "	 	Licensed under the terms of the LGPL. See http://www.ejbca.org/license.html\r\n" + "	 -->\r\n" + "	\r\n" + "	\r\n" + "\r\n" + "	\r\n" + "<!-- netscape -->\r\n" + "<form style=\"visibility: hidden\" action=\"${POSTACTION}\" id=\"keygenform\" enctype=\"x-www-form-encoded\" method=\"post\">\r\n"
         + "  <fieldset>\r\n" + "	<label for=\"keygen\">Key length:</label>\r\n" + "	<keygen name=\"keygen\" id=\"keygen\" challenge=\"${TOKENVALUE}\" />\r\n" + "	<input name=\"token\" type=\"hidden\" value=\"${TOKENVALUE}\" />\r\n" + "	<input type=\"submit\" id=\"ok\" value=\"OK\" />\r\n" + "  </fieldset>\r\n" + "</form>\r\n" + "\r\n" + "\r\n" + "<!-- internet exploder -->    \r\n" + "<script type=\"text/javascript\">\r\n" + "<!--\r\n" + "	\r\n" + "\r\n" + "	function autosubmit (formName) {\r\n" + "		var kgf = document.getElementById(formName);\r\n" + "		kgf.submit();\r\n" + "	}\r\n" + "	\r\n" + "	if (navigator.appName.indexOf(\"Explorer\") != -1) {\r\n" + "	    if ( navigator.userAgent.indexOf(\"Windows NT 6\") != -1 ) {\r\n" + "				document.writeln(\"<object classid=\\\"clsid:884e2049-217d-11da-b2a4-000e7bbb2b09\\\" id=\\\"g_objClassFactory\\\" height=\\\"0\\\" width=\\\"0\\\" ></object>\");\r\n"
         + "			} else {\r\n" + "				document.writeln(\"<object classid=\\\"clsid:127698e4-e730-4e5c-a2b1-21490a70c8a1\\\" id=\\\"newencoder\\\" codebase=\\\"/CertControl/xenroll.cab#Version=5,131,3659,0\\\" height=\\\"0\\\" width=\\\"0\\\" ></object>\");\r\n"
         + "				document.writeln(\"<object classid=\\\"clsid:43F8F289-7A20-11D0-8F06-00C04FC295E1\\\" id=\\\"oldencoder\\\" height=\\\"0\\\" width=\\\"0\\\" ></object>\");\r\n"
         + "			}\r\n" + "			\r\n" + "		} else {\r\n" + "			window.onload = autosubmit(\"keygenform\");\r\n" + "		}\r\n" + "-->\r\n" + "</script>\r\n" + "\r\n" + "<script type=\"text/vbscript\">\r\n" + "<!--\r\n" + "	\r\n" + "	Dim g_objEnroll, g_objPrivateKey, g_objRequest, g_objCSPInformations, g_certEnrollLoadError\r\n" + "	' Used by apply_exp.jspf\r\n" + "	Function InitVistaCSP()\r\n" + "		On Error resume next\r\n" + "		Set g_objEnroll				= g_objClassFactory.CreateObject(\"X509Enrollment.CX509Enrollment\")\r\n" + "		Set g_objPrivateKey			= g_objClassFactory.CreateObject(\"X509Enrollment.CX509PrivateKey\")\r\n" + "		Set g_objRequest			= g_objClassFactory.CreateObject(\"X509Enrollment.CX509CertificateRequestPkcs10\")\r\n"
         + "		Set g_objCSPInformations	= g_objClassFactory.CreateObject(\"X509Enrollment.CCspInformations\")                 \r\n"
         + "		If 0<>Err.Number Then\r\n" + "			g_certEnrollLoadError = Err.Number\r\n" + "		Else\r\n" + "			g_certEnrollLoadError = 0\r\n" + "			g_objCSPInformations.AddAvailableCsps  \r\n" + "		End If\r\n" + "		On Error Goto 0\r\n" + "	End Function\r\n" + "\r\n" + "	' Used by apply_exp.jspf\r\n" + "	Function GetCertEnrollCSPList()\r\n" + "	    On Error Resume Next\r\n" + "	    Dim nDefaultCSP, nCSPIndex, CspInformations, CspInformation, oOption\r\n" + "		Set CspInformations = g_objCSPInformations\r\n" + "	    nDefaultCSP = -1\r\n" + "	    ' Add error message if no CSPs are found\r\n" + "	    If CspInformations.Count = 0 Then\r\n" + "		    Set oOption=document.createElement(\"Option\")\r\n" + "		    oOption.text=\"N/A\"\r\n" + "			document.CertReqForm.CspProvider.add(oOption)\r\n" + "        Else \r\n" + "        	'Loop through all CspInformation objects\r\n" + "        	For nCSPIndex = 0 To CspInformations.Count-1\r\n" + "				Set CspInformation = CspInformations.ItemByIndex(nCSPIndex)\r\n" + "				If True = CspInformation.LegacyCsp Then	'Make sure that it's a Next Generation (CNG) provider\r\n"
         + "					Set oOption = document.createElement(\"Option\")\r\n" + "					oOption.text = CspInformation.Name\r\n" + "					oOption.Value = CspInformation.Type\r\n" + "					document.CertReqForm.CspProvider.add(oOption)\r\n" + "					If InStr(CspInformation.Name, \"Microsoft Enhanced Cryptographic Provider\") <> 0 Then\r\n"
         + "						oOption.selected = True\r\n" + "						nDefaultCSP = nCSPIndex\r\n" + "					End If\r\n" + "					If InStr(CspInformation.Name, \"Microsoft Base Cryptographic Provider\") <> 0 Then\r\n" + "						If nDefaultCSP = -1 Then nDefaultCSP = nCSPIndex\r\n" + "					End If\r\n" + "       			End If\r\n" + "	        Next\r\n" + "	    End If ' if 0 == CspInformations.Count\r\n" + "	    If nDefaultCSP <> -1 Then\r\n" + "		    Document.CertReqForm.CspProvider.selectedIndex = nDefaultCSP\r\n" + "		Else\r\n" + "		    Document.CertReqForm.CspProvider.selectedIndex = 0	'Select first or N/A\r\n" + "	    End If\r\n" + "    End Function	'GetCertEnrollCSPList\r\n" + "\r\n" + "\r\n" + "	If InStr(Navigator.UserAgent, \"Windows NT 6\") <> 0 Then\r\n" + "		InitVistaCSP()\r\n" + "	End if\r\n" + "\r\n" + "	' Code for IE under XP or earlier. Placed here since script src=... does not seem to work.\r\n" + "    Dim useold\r\n" + "    useold=false\r\n" + "\r\n" + "    Function GetProviderList()\r\n" + "	\r\n" + "	   Dim CspList, cspIndex, ProviderName\r\n" + "	   On Error Resume Next\r\n" + "	\r\n" + "	   count = 0\r\n" + "	   base = -1\r\n" + "	   enhanced = 0\r\n" + "	   CspList = \"\"\r\n" + "	   ProviderName = \"\"\r\n" + "	\r\n" + "	   For ProvType = 0 to 13\r\n" + "	      cspIndex = 0\r\n" + "	      newencoder.ProviderType = ProvType\r\n" + "	      ProviderName = newencoder.enumProviders(cspIndex,0)\r\n" + "	\r\n" + "	      while ProviderName <> \"\"\r\n" + "	         Set oOption = document.createElement(\"option\")\r\n" + "	         oOption.text = ProviderName\r\n" + "	         oOption.value = ProvType\r\n" + "	         Document.CertReqForm.CspProvider.add(oOption)\r\n" + "	         if ProviderName = \"Microsoft Base Cryptographic Provider v1.0\" Then\r\n" + "	            base = count\r\n" + "	         end if\r\n" + "	         if ProviderName = \"Microsoft Enhanced Cryptographic Provider v1.0\" Then\r\n" + "	            enhanced = count\r\n" + "	         end if\r\n" + "	         cspIndex = cspIndex +1\r\n" + "	         ProviderName = \"\"\r\n" + "	         ProviderName = newencoder.enumProviders(cspIndex,0)\r\n" + "	         count = count + 1\r\n" + "	      wend\r\n" + "	   Next\r\n" + "	   If base = -1 Then\r\n" + "	     useold=true\r\n" + "	     Document.CertReqForm.classid.value=\"clsid:43F8F289-7A20-11D0-8F06-00C04FC295E1\"\r\n" + "	     count = 0\r\n" + "	     enhanced = 0\r\n" + "	     basename = \"\"\r\n" + "	     enhancedname = \"\"\r\n" + "	     CspList = \"\"\r\n" + "	     ProviderName = \"\"\r\n" + "	\r\n" + "	     For ProvType = 0 to 13\r\n" + "	         cspIndex = 0\r\n" + "	         oldencoder.ProviderType = ProvType\r\n" + "	         ProviderName = oldencoder.enumProviders(cspIndex,0)\r\n" + "	\r\n" + "	        while ProviderName <> \"\"\r\n" + "	           Set oOption = document.createElement(\"option\")\r\n" + "	           oOption.text = ProviderName\r\n" + "	           oOption.value = ProvType\r\n" + "	           Document.CertReqForm.CspProvider.add(oOption)\r\n" + "	           if ProviderName = \"Microsoft Base Cryptographic Provider v1.0\" Then\r\n" + "	            base = count\r\n" + "	           end if\r\n" + "	           if ProviderName = \"Microsoft Enhanced Cryptographic Provider v1.0\" Then\r\n" + "	            enhanced = count\r\n" + "	           end if\r\n" + "	           cspIndex = cspIndex +1\r\n" + "	           ProviderName = \"\"\r\n" + "	           ProviderName = oldencoder.enumProviders(cspIndex,0)\r\n" + "	           count = count + 1\r\n" + "	        wend\r\n" + "	     Next\r\n" + "	   End If \r\n" + "	   Document.CertReqForm.CspProvider.selectedIndex = base\r\n" + "	   if enhanced then\r\n" + "	      Document.CertReqForm.CspProvider.selectedIndex = enhanced\r\n" + "	   end if\r\n" + "   End Function\r\n" + "\r\n" + "   Function NewCSR(keyflags)\r\n" + "      NewCSR = \"\"\r\n" + "      szName = \"CN=6AEK347fw8vWE424\"\r\n" + "       newencoder.reset  \r\n" + "       newencoder.HashAlgorithm = \"MD5\"\r\n" + "       err.clear\r\n" + "       On Error Resume Next\r\n" + "       set options = document.all.CspProvider.options\r\n" + "       index = options.selectedIndex\r\n" + "       newencoder.providerName = options(index).text\r\n" + "       tmpProviderType = options(index).value\r\n" + "       newencoder.providerType = tmpProviderType\r\n" + "       if Document.CertReqForm.enchancedeid.checked then      \r\n" + "         newencoder.ContainerName = \"\\Prime EID IP1 (basic PIN)\\E\"\r\n" + "       end if\r\n" + "       newencoder.KeySpec = 2\r\n" + "       if tmpProviderType < 2 Then\r\n" + "          newencoder.KeySpec = 1\r\n" + "       end if\r\n" + "       \r\n" + "       keysize = document.CertReqForm.keysize.value\r\n" + "       keymask = keysize * 65536\r\n" + "       \r\n" + "       newencoder.GenKeyFlags = keymask OR keyflags\r\n" + " \r\n" + "       NewCSR = newencoder.createPKCS10(szName, \"\")\r\n" + "       if len(NewCSR)<>0 then Exit Function\r\n" + "       if newencoder.providerName = \"Microsoft Enhanced Cryptographic Provider v1.0\" Then\r\n" + "          if MsgBox(\"1024-bit key generation failed. Would you like to try 512 instead?\", vbOkCancel)=vbOk Then\r\n"
         + "             newencoder.providerName = \"Microsoft Base Cryptographic Provider v1.0\"\r\n" + "          else\r\n" + "             Exit Function\r\n" + "          end if\r\n" + "       end if\r\n" + "       newencoder.GenKeyFlags = keyflags\r\n" + "       NewCSR = newencoder.createPKCS10(szName, \"\")\r\n" + "       if len(NewCSR)<>0 then Exit Function\r\n" + "       newencoder.GenKeyFlags = 0\r\n" + "       NewCSR = newencoder.createPKCS10(szName, \"\")\r\n" + "    End Function\r\n" + "\r\n" + "   Function OldCSR(keyflags)\r\n" + "      OldCSR = \"\"\r\n" + "      szName = \"CN=6AEK347fw8vWE424\"\r\n" + "       oldencoder.reset\r\n" + "       oldencoder.HashAlgorithm = \"MD5\"\r\n" + "       err.clear\r\n" + "       On Error Resume Next\r\n" + "       set options = document.all.CspProvider.options\r\n" + "       index = options.selectedIndex\r\n" + "       oldencoder.providerName = options(index).text\r\n" + "       tmpProviderType = options(index).value\r\n" + "       oldencoder.providerType = tmpProviderType\r\n" + "       if Document.CertReqForm.enchancedeid.checked then         \r\n" + "         oldencoder.ContainerName = \"\\Prime EID IP1 (basic PIN)\\E\"\r\n" + "       end if\r\n" + "       oldencoder.KeySpec = 2\r\n" + "       if tmpProviderType < 2 Then\r\n" + "          oldencoder.KeySpec = 1\r\n" + "       end if\r\n" + "       \r\n" + "       keysize = document.CertReqForm.keysize.value\r\n" + "       keymask = keysize * 65536\r\n" + "       \r\n" + "       oldencoder.GenKeyFlags = keymask OR keyflags\r\n" + "       OldCSR = oldencoder.createPKCS10(szName, \"\")\r\n" + "       if len(OldCSR)<>0 then Exit Function\r\n" + "       if oldencoder.providerName = \"Microsoft Enhanced Cryptographic Provider v1.0\" Then\r\n" + "          if MsgBox(\"1024-bit key generation failed. Would you like to try 512 instead?\", vbOkCancel)=vbOk Then\r\n"
         + "             oldencoder.providerName = \"Microsoft Base Cryptographic Provider v1.0\"\r\n" + "          else\r\n" + "             Exit Function\r\n" + "          end if\r\n" + "       end if\r\n" + "       oldencoder.GenKeyFlags = keyflags\r\n" + "       OldCSR = oldencoder.createPKCS10(szName, \"\")\r\n" + "       if len(OldCSR)<>0 then Exit Function\r\n" + "       oldencoder.GenKeyFlags = 0\r\n" + "       OldCSR = oldencoder.createPKCS10(szName, \"\")\r\n" + "    End Function\r\n" + "    \r\n" + "   	' Used b apply_exp.jspf\r\n" + "	Function GetCSR(exportflag)\r\n" + "		GetCSR = \"\"\r\n" + "		' Get provider name and type\r\n" + "		Dim ProviderName, ProviderType\r\n" + "		ProviderName = document.all.CspProvider.options(document.all.CspProvider.options.selectedIndex).text\r\n"
         + "		ProviderType = document.all.CspProvider.options(document.all.CspProvider.options.selectedIndex).value\r\n"
         + "		g_objPrivateKey.ProviderName = ProviderName\r\n" + "		g_objPrivateKey.ProviderType = ProviderType\r\n" + "		g_objPrivateKey.Length = document.CertReqForm.keysize.value\r\n" + "		If ProviderType < 2 Then\r\n" + "			g_objPrivateKey.KeySpec = 1	'AT_KEYEXCHANGE\r\n" + "		Else\r\n" + "			g_objPrivateKey.KeySpec = 2	'AT_SIGNATURE\r\n" + "		End If\r\n" + "		g_objPrivateKey.MachineContext = false\r\n" + "		g_objPrivateKey.KeyProtection = 1	' (XCN_NCRYPT_UI_PROTECT_KEY_FLAG = 1)\r\n" + "		g_objPrivateKey.ExportPolicy = exportflag	' (XCN_NCRYPT_ALLOW_EXPORT_FLAG = 1)\r\n" + "	    If Document.CertReqForm.enchancedeid.checked then\r\n" + "	    	If Document.CertReqForm.containername = \"\" Then\r\n" + "				g_objPrivateKey.ContainerName = \"\\Prime EID IP1 (basic PIN)\\E\"\r\n" + "			Else\r\n" + "				g_objPrivateKey.ContainerName = Document.CertReqForm.containername.value\r\n" + "			End If\r\n" + "			g_objPrivateKey.Existing = True\r\n" + "		Else\r\n" + "			g_objPrivateKey.Existing = False\r\n" + "		End if\r\n" + "		' Initialize\r\n" + "		Call g_objRequest.InitializeFromPrivateKey(1, g_objPrivateKey, \"\")	'X509CertificateEnrollmentContext.ContextUser\r\n"
         + "		Dim X500DistinguishedName\r\n" + "		Set X500DistinguishedName = g_objClassFactory.CreateObject(\"X509Enrollment.CX500DistinguishedName\")\r\n"
         + "		Call X500DistinguishedName.Encode(\"CN=6AEK347fw8vWE424\", 0)	'XCN_CERT_NAME_STR_NONE\r\n" + "		g_objRequest.Subject = X500DistinguishedName\r\n" + "		' Set hash algo\r\n" + "		Dim CspInformation, CspAlgorithms, CspAlgorithm, nBestIndex, nAlgIndex\r\n" + "		Set CspInformation = g_objCSPInformations.ItemByName(ProviderName)\r\n" + "		Set CspAlgorithms = CspInformation.CspAlgorithms\r\n" + "		nBestIndex = 0\r\n" + "		For nAlgIndex=0 To CspAlgorithms.Count-1\r\n" + "			If CspAlgorithms.ItemByIndex(nAlgIndex).Name = \"sha1\" Then\r\n" + "				nBestIndex = nAlgIndex\r\n" + "			End If\r\n" + "			If CspAlgorithms.ItemByIndex(nAlgIndex).Name = \"md5\" AND CspAlgorithms.ItemByIndex(nBestIndex).Name <> \"sha1\" Then\r\n"
         + "				nBestIndex = nAlgIndex\r\n" + "			End If\r\n" + "		Next\r\n" + "		Set CspAlgorithm = CspAlgorithms.ItemByIndex(nBestIndex)\r\n" + "		If CspAlgorithm.Type = 2 Then	'XCN_CRYPT_HASH_INTERFACE\r\n" + "			g_objRequest.HashAlgorithm = CspAlgorithm.GetAlgorithmOid(0, 0)	', AlgorithmFlagsNone\r\n" + "		End if\r\n" + "		' Try to create request\r\n" + "		g_objEnroll.InitializeFromRequest(g_objRequest)\r\n" + "		GetCSR = g_objEnroll.CreateRequest(3)	'CRYPT_STRING_BASE64REQUESTHEADER\r\n" + "		if len(GetCSR)<>0 then Exit Function\r\n" + "	End Function	'GetCSR\r\n" + "\r\n" + "	Function ControlExists(objectID)\r\n" + "		on error resume next\r\n" + "		ControlExists = IsObject(CreateObject(objectID))\r\n" + "	End Function\r\n" + "\r\n" + "	' Used by both post and pre Vista code	\r\n" + "	Sub GenReq_OnClick\r\n" + "		Dim TheForm, result\r\n" + "		Set TheForm = Document.CertReqForm\r\n" + "		err.clear\r\n" + "		If InStr(Navigator.UserAgent, \"Windows NT 6\") <> 0 Then\r\n" + "			If g_certEnrollLoadError <> 0 Then\r\n" + "				Call MsgBox(\"Could not load CertEnroll.\", 0, \"Alert\")\r\n" + "				Exit Sub\r\n" + "			End if\r\n" + "			If Document.CertReqForm.exportable.checked then\r\n" + "				result = GetCSR(1)\r\n" + "			Else\r\n" + "				result = GetCSR(0)\r\n" + "			End If\r\n" + "		Else\r\n" + "			If useold Then\r\n" + "				If Document.CertReqForm.exportable.checked then\r\n" + "					result = OldCSR(2 + 1)\r\n" + "				Else\r\n" + "					result = OldCSR(2)\r\n" + "				End If\r\n" + "			Else\r\n" + "				If Document.CertReqForm.exportable.checked then\r\n" + "					result = NewCSR(2 + 1)\r\n" + "				Else\r\n" + "					result = NewCSR(2)\r\n" + "				End If\r\n" + "			End If\r\n" + "		End If\r\n" + "		if len(result)=0 Then\r\n" + "			result = MsgBox(\"Unable to generate PKCS#10 certificate request.\", 0, \"Alert\")\r\n" + "			Exit Sub\r\n" + "		End If\r\n" + "		TheForm.pkcs10.Value = result\r\n" + "		TheForm.Submit\r\n" + "		Exit Sub\r\n" + "	End Sub	'GenReq_OnClick\r\n" + "	\r\n" + "-->      \r\n" + "</script>\r\n" + "\r\n" + "\r\n" + "<div style=\"visibility:hidden\" id=\"explorercode\">\r\n" + "\r\n" + "<form name=\"CertReqForm\" action=\"${POSTACTION}\" enctype=\"x-www-form-encoded\" method=\"POST\">\r\n" + "	<input name=\"token\" type=\"hidden\" value=\"${TOKENVALUE}\" />\r\n" + "	<input name=\"classid\" type=\"hidden\" value=\"\" />\r\n" + "    <input name=\"pkcs10\" type=\"hidden\" value=\"\" />\r\n" + "    <input name=\"containername\" type=\"hidden\" value=\"\" />\r\n" + "	<input type=\"hidden\" name=\"keysize\" id=\"keysize\" value=\"2048\" />\r\n" + "    <input type=\"hidden\" name=\"enchancedeid\" value=\"true\" /> \r\n" + "    <input type=\"hidden\" name=\"exportable\" value=\"true\" /> \r\n" + "	<select style=\"visibility: hidden\" disabled=\"true\" name=\"CspProvider\" id=\"CspProvider\" accesskey=\"p\"></select>\r\n"
         + "	<input type=\"button\" value=\"OK\" id=\"okbutton\" name=\"GenReq\">\r\n" + "</form>\r\n" + "\r\n" + "\r\n" + "</div>\r\n" + "\r\n" + "<script type=\"text/javascript\">\r\n" + "<!--\r\n" + "	\r\n" + "	if (navigator.appName.indexOf(\"Explorer\") != -1) {\r\n" + "		document.getElementById('explorercode').style.visibility = 'visible';\r\n" + "	}\r\n" + "-->\r\n" + "</script>\r\n" + "\r\n" + "\r\n" + "<script type=\"text/vbscript\" defer=\"true\">\r\n" + "<!--\r\n" + "\r\n" + "	If InStr(Navigator.UserAgent, \"Windows NT 6\") <> 0 Then\r\n" + "		Call GetCertEnrollCSPList()\r\n" + "		Document.CertReqForm.classid.value = \"clsid:884e2049-217d-11da-b2a4-000e7bbb2b09\"\r\n" + "	Else\r\n" + "		GetProviderList()\r\n" + "	End If\r\n" + "-->\r\n" + "</script>\r\n" + "\r\n" + "\r\n" + "  </body>\r\n" + "</html>\r\n" + "\r\n" + "";
}
